{% extends "base.html" %}
{% block content %}


 <div class="container">
 <div class="row">
  <div class="col-md-10"></div>
  <div class="col-md-2">
    <div id="google_translate_element"></div>
  </div>
 </div>

   <div class="row">
      <div class="col-md-12">
         <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
               <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-settings" role="tab" aria-controls="nav-home" aria-selected="true"><i class="fa fa-code" aria-hidden="true"></i> Basic Elements</a>
               {% if active_flag == 'ACTIVE' %}
               <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-preview" role="tab" aria-controls="nav-profile" aria-selected="false"><i class="fa fa-plus" aria-hidden="true"></i> Custom Elements</a>
               <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-help" role="tab" aria-controls="nav-contact" aria-selected="false"><i class="fa fa-font" aria-hidden="true"></i> My Fonts</a>
               {% endif %}
               {% if active_flag == 'INACTIVE' %}
                  <a class="nav-item nav-link" id="upgradeNow"  role="tab"  aria-selected="false" data-toggle="modal" data-target="#demoModal"> <i class="fa fa-smile-o" aria-hidden="true"></i> Upgrade</a>
               {% endif %}
               <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-app-settings" role="tab" aria-controls="nav-profile" aria-selected="false"> <i class="fa fa-cog" aria-hidden="true"></i> Settings</a>
            </div>
         </nav>
         <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-settings" role="tabpanel" aria-labelledby="nav-home-tab">
               <div class="container mt-4">

                 <div class="row mb-3">


      <div class="col-md-10"></div>
      <div class="col-md-1">
          <button id="save" class="btn btn-gradient btn-lg"><i class="fa fa-floppy-o" aria-hidden="true"></i></button>
      </div>
      <div class="col-md-1">
          <a href="{{store_url}}" target="_blank" class="btn btn-gradient btn-lg"><i class="fa fa-eye" aria-hidden="true"></i></a>
      </div>
    </div>



                  <div class="row">
                     <div class="col-md-12">
                        <table class="table" style="text-align: center;">
                           <thead>
                              <tr>
                                 <th scope="col">Element</th>
                                 <th scope="col">Font Type </th>
                                 <th scope="col">Choose Font</th>
                                 <th scope="col">Activation Status</th>
                              </tr>
                           </thead>
                           <tbody>

                              <tr>
                                 <td>All (Body)</td>
                                 <td style="width:20%;">

                                    <div class="form-group">
                                    <select class="form-control" id="body-type-select" disabled="on">
                                      <option value="body-default">Select Type</option>
                                      <option value="body-google">Google</option>
                                      <option value="body-custom">Custom</option>
                                    </select>
                                  </div>

                                 </td>

                                <td id="body-selector" style="width:20%;">
                                  <div class="google-body-div"><input class="google-body"></div>
                                  <div class="custom-body-div">
                                        <select class="form-control custom-body">
                                        <option value="none">Select Font</option>
                                          {%  for font in store_fonts %}
                                            <option value="{{font.font_name}}">{{font.font_name}}</option>
                                          {% endfor %}
                                        </select>
                                  </div>
                                  <div class="default-body-div"></div>
                                </td>

                                <td><input type="checkbox" id="body-toggle"></td>

                              </tr>


                              <!-- IF BODY IS ENABLED  DISABLE BELOW -->

                               <tr id="h1-row">
                                 <td>H1 Headings </td>
                                 <td style="width:20%;">

                                    <div class="form-group">
                                    <select class="form-control" id="h1-type-select" disabled="on">
                                      <option value="h1-default">Select Type</option>
                                      <option value="h1-google">Google</option>
                                      <option value="h1-custom">Custom</option>
                                    </select>
                                  </div>

                                 </td>

                                <td id="h1-selector" style="width:20%;">
                                  <div class="google-h1-div"><input class="google-h1"></div>
                                  <div class="custom-h1-div">
                                        <select class="form-control custom-h1">
                                        <option value="none">Select Font</option>
                                          {%  for font in store_fonts %}
                                            <option value="{{font.font_name}}">{{font.font_name}}</option>
                                          {% endfor %}
                                        </select>
                                  </div>
                                  <div class="default-h1-div"></div>
                                </td>

                                <td><input type="checkbox" id="h1-toggle"></td>

                              </tr>



                               <tr id="h2-row">
                                 <td>H2 Headings </td>
                                 <td style="width:20%;">

                                    <div class="form-group">
                                    <select class="form-control" id="h2-type-select" disabled="on">
                                      <option value="h2-default">Select Type</option>
                                      <option value="h2-google">Google</option>
                                      <option value="h2-custom">Custom</option>
                                    </select>
                                  </div>

                                 </td>

                                <td id="h2-selector" style="width:20%;">
                                  <div class="google-h2-div"><input class="google-h2"></div>
                                  <div class="custom-h2-div">
                                        <select class="form-control custom-h2">
                                        <option value="none">Select Font</option>
                                          {%  for font in store_fonts %}
                                            <option value="{{font.font_name}}">{{font.font_name}}</option>
                                          {% endfor %}
                                        </select>
                                  </div>
                                  <div class="default-h2-div"></div>
                                </td>

                                <td><input type="checkbox" id="h2-toggle"></td>

                              </tr>



                               <tr id="h3-row">
                                 <td>H3 Headings </td>
                                 <td style="width:20%;">

                                    <div class="form-group">
                                    <select class="form-control" id="h3-type-select" disabled="on">
                                      <option value="h3-default">Select Type</option>
                                      <option value="h3-google">Google</option>
                                      <option value="h3-custom">Custom</option>
                                    </select>
                                  </div>

                                 </td>

                                <td id="h3-selector" style="width:20%;">
                                  <div class="google-h3-div"><input class="google-h3"></div>
                                  <div class="custom-h3-div">
                                        <select class="form-control custom-h3">
                                        <option value="none">Select Font</option>
                                          {%  for font in store_fonts %}
                                            <option value="{{font.font_name}}">{{font.font_name}}</option>
                                          {% endfor %}
                                        </select>
                                  </div>
                                  <div class="default-h3-div"></div>
                                </td>

                                <td><input type="checkbox" id="h3-toggle"></td>

                              </tr>



                               <tr id="h4-row">
                                 <td>H4 Headings </td>
                                 <td style="width:20%;">

                                    <div class="form-group">
                                    <select class="form-control" id="h4-type-select" disabled="on">
                                      <option value="h4-default">Select Type</option>
                                      <option value="h4-google">Google</option>
                                      <option value="h4-custom">Custom</option>
                                    </select>
                                  </div>

                                 </td>

                                <td id="h4-selector" style="width:20%;">
                                  <div class="google-h4-div"><input class="google-h4"></div>
                                  <div class="custom-h4-div">
                                        <select class="form-control custom-h4">
                                        <option value="none">Select Font</option>
                                          {%  for font in store_fonts %}
                                            <option value="{{font.font_name}}">{{font.font_name}}</option>
                                          {% endfor %}
                                        </select>
                                  </div>
                                  <div class="default-h4-div"></div>
                                </td>

                                <td><input type="checkbox" id="h4-toggle"></td>

                              </tr>



                               <tr id="h5-row">
                                 <td>H5 Headings </td>
                                 <td style="width:20%;">

                                    <div class="form-group">
                                    <select class="form-control" id="h5-type-select" disabled="on">
                                      <option value="h5-default">Select Type</option>
                                      <option value="h5-google">Google</option>
                                      <option value="h5-custom">Custom</option>
                                    </select>
                                  </div>

                                 </td>

                                <td id="h5-selector" style="width:20%;">
                                  <div class="google-h5-div"><input class="google-h5"></div>
                                  <div class="custom-h5-div">
                                        <select class="form-control custom-h5">
                                        <option value="none">Select Font</option>
                                          {%  for font in store_fonts %}
                                            <option value="{{font.font_name}}">{{font.font_name}}</option>
                                          {% endfor %}
                                        </select>
                                  </div>
                                  <div class="default-h5-div"></div>
                                </td>

                                <td><input type="checkbox" id="h5-toggle"></td>

                              </tr>



                               <tr id="h6-row">
                                 <td>H6 Headings </td>
                                 <td style="width:20%;">

                                    <div class="form-group">
                                    <select class="form-control" id="h6-type-select" disabled="on">
                                      <option value="h6-default">Select Type</option>
                                      <option value="h6-google">Google</option>
                                      <option value="h6-custom">Custom</option>
                                    </select>
                                  </div>

                                 </td>

                                <td id="h6-selector" style="width:20%;">
                                  <div class="google-h6-div"><input class="google-h6"></div>
                                  <div class="custom-h6-div">
                                        <select class="form-control custom-h6">
                                        <option value="none">Select Font</option>
                                          {%  for font in store_fonts %}
                                            <option value="{{font.font_name}}">{{font.font_name}}</option>
                                          {% endfor %}
                                        </select>
                                  </div>
                                  <div class="default-h6-div"></div>
                                </td>

                                <td><input type="checkbox" id="h6-toggle"></td>

                              </tr>



                               <tr id="p-row">
                                 <td>Paragraph Tags (P Tags)  </td>
                                 <td style="width:20%;">

                                    <div class="form-group">
                                    <select class="form-control" id="p-type-select" disabled="on">
                                      <option value="p-default">Select Type</option>
                                      <option value="p-google">Google</option>
                                      <option value="p-custom">Custom</option>
                                    </select>
                                  </div>

                                 </td>

                                <td id="p-selector" style="width:20%;">
                                  <div class="google-p-div"><input class="google-p"></div>
                                  <div class="custom-p-div">
                                        <select class="form-control custom-p">
                                          <option value="none">Select Font</option>
                                          {%  for font in store_fonts %}
                                            <option value="{{font.font_name}}">{{font.font_name}}</option>
                                          {% endfor %}
                                        </select>
                                  </div>
                                  <div class="default-p-div"></div>
                                </td>

                                <td><input type="checkbox" id="p-toggle"></td>

                              </tr>


                                <tr id="block-row">
                                 <td>BlockQuote Tags</td>
                                 <td style="width:20%;">

                                    <div class="form-group">
                                    <select class="form-control" id="block-type-select" disabled="on">
                                      <option value="block-default">Select Type</option>
                                      <option value="block-google">Google</option>
                                      <option value="block-custom">Custom</option>
                                    </select>
                                  </div>

                                 </td>

                                <td id="block-selector" style="width:20%;">
                                  <div class="google-block-div"><input class="google-block"></div>
                                  <div class="custom-block-div">
                                        <select class="form-control custom-block">
                                        <option value="none">Select Font</option>
                                          {%  for font in store_fonts %}
                                            <option value="{{font.font_name}}">{{font.font_name}}</option>
                                          {% endfor %}
                                        </select>
                                  </div>
                                  <div class="default-block-div"></div>
                                </td>

                                <td><input type="checkbox" id="block-toggle"></td>

                              </tr>



                              <tr id="li-row">
                                 <td>List Tags (li)</td>
                                 <td style="width:20%;">

                                    <div class="form-group">
                                    <select class="form-control" id="li-type-select" disabled="on">
                                      <option value="li-default">Select Type</option>
                                      <option value="li-google">Google</option>
                                      <option value="li-custom">Custom</option>
                                    </select>
                                  </div>

                                 </td>

                                <td id="li-selector" style="width:20%;">
                                  <div class="google-li-div"><input class="google-li"></div>
                                  <div class="custom-li-div">
                                        <select class="form-control custom-li">
                                        <option value="none">Select Font</option>
                                          {%  for font in store_fonts %}
                                            <option value="{{font.font_name}}">{{font.font_name}}</option>
                                          {% endfor %}
                                        </select>
                                  </div>
                                  <div class="default-li-div"></div>
                                </td>

                                 <td><input type="checkbox" id="li-toggle"></td>

                              </tr>



                              <tr id="a-row">
                                 <td>A Tags (a)</td>
                                 <td style="width:20%;">

                                    <div class="form-group">
                                    <select class="form-control" id="a-type-select" disabled="on">
                                      <option value="a-default">Select Type</option>
                                      <option value="a-google">Google</option>
                                      <option value="a-custom">Custom</option>
                                    </select>
                                  </div>

                                 </td>

                                <td id="a-selector" style="width:20%;">
                                  <div class="google-a-div"><input class="google-a"></div>
                                  <div class="custom-a-div">
                                        <select class="form-control custom-a">
                                        <option value="none">Select Font</option>
                                          {%  for font in store_fonts %}
                                            <option value="{{font.font_name}}">{{font.font_name}}</option>
                                          {% endfor %}
                                        </select>
                                  </div>
                                  <div class="default-a-div"></div>
                                </td>

                                 <td><input type="checkbox" id="a-toggle"></td>

                              </tr>




                              <!-- ENDS HERE -->



                           </tbody>
                        </table>
                     </div>
                  </div>
               </div>
            </div>
            <div class="tab-pane fade" id="nav-preview" role="tabpanel" aria-labelledby="nav-profile-tab">

              <div class="container">
                <div class="row mt-3">
                   <div class="col-md-10">
                   </div>
                      <div class="col-md-1">
                          <button id="customSubmit"  class="btn btn-gradient btn-lg"><i class="fa fa-floppy-o" aria-hidden="true"></i></button>
                      </div>
                    <div class="col-md-1">
                        <a href="{{store_url}}" target="_blank" class="btn btn-gradient btn-lg"><i class="fa fa-eye" aria-hidden="true"></i></a>
                    </div>
                </div>

                <div class="row mt-3">
                  <div class="col-md-10">
                          <div class="form-group">
                           <textarea class="form-control" readonly id="customClasses" placeholder="Custom Classes Are Added Here" name="custom-elements"></textarea>    
                          </div>
                        </div>
                          <div class="col-md-1 ml-3">
                            <div class="form-group">
                           <button class=" btn btn-lg btn-gradient btn-picker-element" type="button" data-src="https://shristorey.myshopify.com" data-hover="Elements picker"><i class="fa fa-mouse-pointer" aria-hidden="true"></i> Picker</button>
                          </div>
                          </div>


                </div>
                <div class="row">
                  <div class="col-md-12">
                    <table class="table">
                           <thead style="text-align: center;">
                              <tr>
                                 <th scope="col">Font Type</th>
                                 <th scope="col">Choose Font</th>
                              </tr>
                           </thead>
                           <tbody style="text-align: center;">
                              <tr>
                                 <td style="width:30%;">
                                  <div class="form-group">
                                    <select class="form-control" id="custom-picker-select">
                                      <option value="custom-picker-default">Select Type</option>
                                      <option value="custom-picker-google" selected>Google</option>
                                      <option value="custom-picker-custom">Custom</option>
                                    </select>
                                  </div>

                                 </td>
                                 <td style="width:30%;">
                                        <div class="google-custom-picker"><input class="google-font-picker"></div>
                                        <div class="custom-custom-picker" style="display:none;">
                                          <select class="form-control custom-font-picker">
                                          <option value="none">Select Font</option>
                                            {%  for font in store_fonts %}
                                              <option value="{{font.font_name}}">{{font.font_name}}</option>
                                            {% endfor %}
                                          </select>
                                        </div>
                                 </td>
                              </tr>

                            </tbody>
                          </table>
                  </div>
                </div>


              <div class="row">
                <div class="col-md-12">
                   <table class="table">
                           <thead style="text-align: center;">
                              <tr>
                                 <th scope="col">Custom Elements</th>
                                 <th scope="col">Status</th>
                              </tr>
                           </thead>
                           <tbody style="text-align: center;">
                              {%  for custom_el in custom_elements %}
                              <tr>
                                 <td>{{custom_el.custom_classes}}</td>
                                 <td>Active</td>
                              </tr>

                              {% endfor %}

                            </tbody>
                          </table>

                </div>
              </div>





              </div>
            </div>

            <!-- CUSTOM ELEMENTS JS SCRIPT -->
            <script>
              var custom_elements_font = '';

              $('.google-font-picker').fontpicker();
              $('#custom-picker-select').on('change', function() {
                var el = this.value;
                if(el == 'custom-picker-google'){
                  //hide custom-custom-picker
                   $('.google-custom-picker').show();
                   $('.custom-custom-picker').hide();
                }
                if(el == 'custom-picker-custom'){
                  //hide google custom picker
                   $('.custom-custom-picker').show();
                   $('.google-custom-picker').hide();
                }

              });
                   $('.google-font-picker').fontpicker().on('change', function() {
                        custom_elements_font = this.value;
                   });
                   $('.custom-font-picker').on('change', function() {
                      custom_elements_font = this.value;
                   });

              $('#customSubmit').click(function(){

                
              $('#customSubmit').html('<i class="fa fa-circle-o-notch fa-spin"></i>');


                var custom_classes = $("#customClasses").val();
                var finalized_classes = custom_classes.split("\n");
                finalized_classes = finalized_classes.filter(Boolean)
                var python_list = String(JSON.stringify(finalized_classes)).replaceAll("\"","\'");

                postData = {
                  'custom_classes':python_list,
                  'custom_font':custom_elements_font,
                  'store_token':'{{app_token}}',
                  'store_key':'{{store_token}}',
                  'store_url':'{{shop_url}}',
                }



                if (custom_classes.length < 1) {
                       alert("No Custom Classes Added!");
                       $('#customSubmit').html('<i class="fa fa-floppy-o" aria-hidden="true"></i>');
                       return false;     
                }

                console.log(postData);

/*
                .hero__content-wrapper.hero-initialized .hero__content .hero__content-centered
                .hero__content .hero__content-centered .hero__text-title
                .rich-text__text--medium p
                .grid .grid__item.rte.text-center.medium-up--two-thirds.medium-up--push-one-sixth .rich-text__heading
                .newsletter.text-center h2
*/

                var API_URL = 'https://www.fontman.in';


                //ajax here for updating custom classify_classes
                $.ajax({
                  type:'POST',
                  url: API_URL+'/csubmit/',
                  //url:'http://fontman.in/api/settings/{{app_token}}',
                  data:{ custom_data : JSON.stringify(postData) },
                  success:function(response){
                      console.log('Saved Successfully');
                      console.log(response);
                      $('#customSubmit').html('<i class="fa fa-floppy-o" aria-hidden="true"></i>');
                      location.reload();
                  }
                });

                //ends here

                console.log("CUSTOM FONT IS: "+custom_elements_font);

              });

            </script>
            <!-- ENDS HERE -->
            <!-- CUSTOM FONTS -->
            <div class="tab-pane fade" id="nav-help" role="tabpanel" aria-labelledby="nav-contact-tab">
              <div class="container mt-4">

                <div class="row">

                  <div class="col-md-1"></div>
      <div class="col-md-8 mt-2" >
        <form method="post" action="font_upload/" enctype="multipart/form-data">
        <div class="form-group">
          {% csrf_token %}
          <input type="file" class="form-control" name="myfile" required>
          <input type="hidden" value="{{shop_url}}" name="shop_url">

          <input type="hidden" value="{{store_token}}"  name="store_token">
        </div>
      </div>
      <div class="col-md-2">
        <div class="form-group">
                     <button class="btn btn-gradient btn-lg" type="submit"> <i class="fa fa-upload" aria-hidden="true"></i> Upload</button>
          </form>
        </div>
      </div>
              </div>
                  <div class="row mb-4" style="margin-top:0px;">
                     <div class="col-md-12 text-center">
                        <small style="color:red;">Note: Please upload  woff , woff2, ttf, otf fonts.</small>
                     </div>
                  </div>
              <div class="row">
                <div class="col-md-12">
                   <table class="table">
                           <thead style="text-align: center;">
                              <tr>
                                 <th scope="col">Font Name</th>
                                 <th scope="col">Status</th>
                              </tr>
                           </thead>
                           <tbody style="text-align: center;">
                              {%  for font in store_fonts %}
                              <tr>
                                 <td>{{font.font_name}}</td>
                                 <td>Active</td>
                              </tr>

                              {% endfor %}

                            </tbody>
                          </table>

                </div>
              </div>

              </div>


            </div>
            <!-- ENDS HERE -->

            <div class="tab-pane fade" id="nav-app-settings" role="tabpanel" aria-labelledby="nav-app-settings-tab">
                <div class="container mt-3">
                  <div class="row">
                      <div class="col-md-12">
                        <table class="table">
                           <thead style="text-align: center;">
                           </thead>
                           <tbody style="text-align: center;">
                              {% if active_flag == 'ACTIVE' %}
                              <tr>
                                 <td><i class="fa fa-bars" aria-hidden="true"></i> Account </td>
                                 <td><a class="btn btn-gradient btn-block btn-md" style="color:white;" role="tab"  aria-selected="false" data-toggle="modal" data-target="#demoModal">Downgrade</a></td>
                              </tr>
                              {% endif %}

                              <tr>
                                 <td> <i class="fa fa-bars" aria-hidden="true"></i> Store Reset</td>
                                 <td style="width:80px;"><a class="btn btn-gradient btn-block btn-md" href="reset/{{app_token}}"  role="tab"> Reset </a></td>
                              </tr>


                           </tbody>
                        </table>
                      </div>
                  </div>
                </div>
            </div>
         
         
         </div>
      </div>
   </div>
</div>
{% csrf_token %}

<!-- GOOGLE TRANSLATE HERE -->
<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
}
</script>

<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<!-- ENDS HERE -->

  <script>

    function isCustomFont(font){
      if(font.endsWith('.ttf')||font.endsWith('.otf')||font.endsWith('.woff')||font.endsWith('.woff2')){
        return true;
      }else{
        return false;
      }
    }



    var body_font = '';
    var h1_font = '';
    var h2_font = '';
    var h3_font = '';
    var h4_font = '';
    var h5_font = '';
    var h6_font = '';
    var p_font = '';
    var block_font = '';
    var li_font = '';
    var a_font = '';

    $(document).ready(function(){
      //load fonts for store
      var API_URL = 'https://www.fontman.in';

      $.ajax({
          type:'GET',
          url:API_URL+'/api/fontman',
          data:{'store_token':'{{app_token}}'},
          success:function(response){
            console.log(response);

            //init changes here

            if(response['body_tag']!=null && response['body_tag']!="" ){

              $('#body-toggle').prop("checked", true).change();
              if(isCustomFont(response['body_tag'])){
                //if this is the custom font here
                $('#body-type-select').val('body-custom').change();
                $('.custom-body').val(response['body_tag']).trigger('change');

              }else{
                //else it is a google font
                $('#body-type-select').val('body-google').change();
                $('.google-body').val(response['body_tag']).trigger('change');
              }


            }else{
              //heading tags here
              if(response['h1_tag']!="" && response['h1_tag']!=null ){

                $('#h1-toggle').prop("checked", true).change();
                if(isCustomFont(response['h1_tag'])){
                  //if this is the custom font here
                  $('#h1-type-select').val('h1-custom').change();
                  $('.custom-h1').val(response['h1_tag']).trigger('change');

                }else{
                  //else it is a google font
                  $('#h1-type-select').val('h1-google').change();
                  $('.google-h1').val(response['h1_tag']).trigger('change');
                }


              }
              if(response['h2_tag']!="" &&  response['h2_tag']!=null){

                $('#h2-toggle').prop("checked", true).change();

                if(isCustomFont(response['h2_tag'])){
                  //if this is the custom font here
                  $('#h2-type-select').val('h2-custom').change();
                  $('.custom-h2').val(response['h2_tag']).trigger('change');

                }else{
                  $('#h2-type-select').val('h2-google').change();
                  $('.google-h2').val(response['h2_tag']).trigger('change');
                }


              }
              if(response['h3_tag']!="" &&  response['h3_tag']!=null){

                $('#h3-toggle').prop("checked", true).change();

                if(isCustomFont(response['h3_tag'])){

                  $('#h3-type-select').val('h3-custom').change();
                  $('.custom-h3').val(response['h3_tag']).trigger('change');

                }else{
                  $('#h3-type-select').val('h3-google').change();
                  $('.google-h3').val(response['h3_tag']).trigger('change');
                }


              }
              if(response['h4_tag']!="" && response['h4_tag']!=null){

                $('#h4-toggle').prop("checked", true).change();

                if(isCustomFont(response['h4_tag'])){

                  $('#h4-type-select').val('h4-custom').change();
                  $('.custom-h4').val(response['h4_tag']).trigger('change');

                }else{
                  $('#h4-type-select').val('h4-google').change();
                  $('.google-h4').val(response['h4_tag']).trigger('change');
                }


              }
              if(response['h5_tag']!="" && response['h5_tag']!=null){

                $('#h5-toggle').prop("checked", true).change();

                if(isCustomFont(response['h5_tag'])){

                  $('#h5-type-select').val('h5-custom').change();
                  $('.custom-h5').val(response['h5_tag']).trigger('change');


                }else{
                  $('#h5-type-select').val('h5-google').change();
                  $('.google-h5').val(response['h5_tag']).trigger('change');
                }

              }

              if(response['h6_tag']!="" && response['h6_tag']!=null){

                $('#h6-toggle').prop("checked", true).change();

                if(isCustomFont(response['h6_tag'])){
                  $('#h6-type-select').val('h6-custom').change();
                  $('.custom-h6').val(response['h6_tag']).trigger('change');

                }else{
                    $('#h6-type-select').val('h6-google').change();
                    $('.google-h6').val(response['h6_tag']).trigger('change');
                }


              }
              if(response['p_tag']!="" && response['p_tag']!=null){


                $('#p-toggle').prop("checked", true).change();
                if(isCustomFont(response['p_tag'])){
                    $('#p-type-select').val('p-custom').change();
                    $('.custom-p').val(response['p_tag']).trigger('change');

                }else{
                  $('#p-type-select').val('p-google').change();
                  $('.google-p').val(response['p_tag']).trigger('change');
                }

              }
              if(response['li_tag']!="" && response['li_tag']!=null ){


                $('#li-toggle').prop("checked", true).change();

                if(isCustomFont(response['li_tag'])){

                  $('#li-type-select').val('li-custom').change();
                  $('.custom-li').val(response['li_tag']).trigger('change');

                }else{
                  $('#li-type-select').val('li-google').change();
                  $('.google-li').val(response['li_tag']).trigger('change');
                }

              }
              if(response['a_tag']!="" && response['a_tag']!=null ){


                $('#a-toggle').prop("checked", true).change();

                if(isCustomFont(response['a_tag'])){

                  $('#a-type-select').val('a-custom').change();
                  $('.custom-a').val(response['a_tag']).trigger('change');

                }else{
                  $('#a-type-select').val('a-google').change();
                  $('.google-a').val(response['a_tag']).trigger('change');
                }

              }
              if(response['block_tag']!="" && response['block_tag']!=null ){


                $('#block-toggle').prop("checked", true).change();

                if(isCustomFont(response['block_tag'])){


                  $('#block-type-select').val('block-custom').change();
                  $('.custom-block').val(response['block_tag']).trigger('change');

                }else{
                  $('#block-type-select').val('block-google').change();
                  $('.google-block').val(response['block_tag']).trigger('change');
                }



              }

            }

          }
    });


    });


    //do changes as per selection here

     $('.google-body').fontpicker().on('change', function() {
      body_font = this.value;
    });


     $('.custom-body').on('change', function() {
        body_font = this.value;
    });




    $('.google-h1').fontpicker().on('change', function() {
      h1_font = this.value;
    });

    $('.custom-h1').on('change', function() {
        h1_font = this.value;
    });




    $('.google-h2').fontpicker().on('change', function() {
      h2_font = this.value;
    });

    $('.custom-h2').on('change', function() {
        h2_font = this.value;
    });




    $('.google-h3').fontpicker().on('change', function() {
      h3_font = this.value;
    });

    $('.custom-h3').on('change', function() {
      h3_font = this.value;
    });



    $('.google-h4').fontpicker().on('change', function() {
      h4_font = this.value;
    });


    $('.custom-h4').on('change', function() {
      h4_font = this.value;
    });



    $('.google-h5').fontpicker().on('change', function() {
      h5_font = this.value;
    });


    $('.custom-h5').on('change', function() {
      h5_font = this.value;
    });



    $('.google-h6').fontpicker().on('change', function() {
      h6_font = this.value;
    });

    $('.custom-h6').on('change', function() {
      h6_font = this.value;
    });




    $('.google-p').fontpicker().on('change', function() {
      p_font = this.value;
    });

    $('.custom-p').on('change', function() {
      p_font = this.value;
    });




    $('.google-li').fontpicker().on('change', function() {
      li_font = this.value;
    });

    $('.custom-li').on('change', function() {
      li_font = this.value;
    });





    $('.google-a').fontpicker().on('change', function() {
      a_font = this.value;
    });


    $('.custom-a').on('change', function() {
      a_font = this.value;
    });



    $('.google-block').fontpicker().on('change', function() {
      block_font = this.value;
    });

    $('.custom-block').on('change', function() {
      block_font = this.value;
    });



    var $postData = [];
    var $picker = $(".btn-picker-element, .elements-picker-block");
    var $textarea = $picker;
    $picker.on("click", function (event) {

        console.log("Clicked ");
        var itv;
        var $this = $(this);
        $textarea = $this;
        var target = window.open($picker.data("src"), "_blank", "location=0");
        var $input = $this.closest("div.row").find('[name="custom-elements"]').val(),
            $postData = $input == "" ? [] : $input.split(/\r|\n/g);
        function message(evt) {
            if (typeof evt.data.message == "string" && evt.data.message === "init") {
                console.log("Got request", evt);
                target.postMessage({ message: "pick", data: $postData }, "*");
                return true;
            }
            if (typeof evt.data.message == "string" && evt.data.message == "pull") {
                $postData = evt.data.data;
                $textarea.closest("div.row").find('[name="custom-elements"]').val($postData.join("\n"));
            }
        }
        window.addEventListener("message", message, false);
        itv = setInterval(() => {
            if (!target || !target.opener) {
                clearInterval(itv);
                window.removeEventListener("message", message);
            }
        }, 1000);
    });

  window.addEventListener("message", receiveMessage, false);
    function receiveMessage(event) {
        if (event.origin == "https://www.fontman.in") {
            var e = event;
            if (e.data && e.data.action) {
                switch (e.data.action) {
                    case "fonts":
                        var fonts = Object.keys(e.data.fonts);
                        if (fonts.length < 1) return;
                        console.log(fonts);
                        $('[name="google-font"]').val(decodeURIComponent(fonts[0]));
                        $.fancybox.close();
                        break;
                }
            }
            return true;
        }
    }





  $('#save').click(function(){

        $('#save').html('<i class="fa fa-circle-o-notch fa-spin"></i>');

        //clean finally here
        if(body_font == "none")
          body_font = "";
        if(h1_font == "none")
          h1_font = "";
        if(h2_font == "none")
          h2_font = "";
        if(h3_font == "none")
          h3_font = "";
        if(h5_font == "none")
          h5_font = "";
        if(h6_font == "none")
          h6_font = "";
        if(p_font == "none")
          p_font = "";
        if(li_font == "none")
          li_font = "";
        if(a_font == "none")
          a_font = "";
        if(block_font == "none")
          block_font = "";


        request_data = {
          "store_token":'{{app_token}}',
          "body_tag": body_font,
          "h1_tag": h1_font,
          "h2_tag": h2_font,
          "h3_tag": h3_font,
          "h4_tag": h4_font,
          "h5_tag": h5_font,
          "h6_tag": h6_font,
          "p_tag": p_font,
          "li_tag": li_font,
          "a_tag": a_font,
          "block_tag": block_font,
        };

        console.log(request_data);

        var API_URL = 'https://www.fontman.in';

        $.ajax({
          type:'POST',
          url:API_URL+'/submit/',
          //url:'http://localhost:8000/api/settings/{{store_token}}',
          data:{ font_data: JSON.stringify(request_data) , store_data: JSON.stringify({'store_token':'{{store_token}}','store_url':'{{store_url}}','store_domain':'{{shop_url}}'})},
          success:function(response){

            console.log('Saved Successfully');
            $('#save').html('<i class="fa fa-floppy-o" aria-hidden="true"></i>');
            location.reload();
          }
        });


  });





  function resetGoogleFonts(){
    //all google fonts here
    $('.google-body').val('').trigger('change');
    $('.google-h1').val('').trigger('change');
    $('.google-h2').val('').trigger('change');
    $('.google-h3').val('').trigger('change');
    $('.google-h4').val('').trigger('change');
    $('.google-h5').val('').trigger('change');
    $('.google-h6').val('').trigger('change');
    $('.google-p').val('').trigger('change');
    $('.google-a').val('').trigger('change');
    $('.google-li').val('').trigger('change');
    $('.google-block').val('').trigger('change');
  }

  function resetCustomFonts(){
    //all custom fonts here
  }


  /* init font pitcker here */

  $('.google-body').fontpicker();
  $('.google-h1').fontpicker();
  $('.google-h2').fontpicker();
  $('.google-h3').fontpicker();
  $('.google-h4').fontpicker();
  $('.google-h5').fontpicker();
  $('.google-h6').fontpicker();
  $('.google-p').fontpicker();
  $('.google-a').fontpicker();
  $('.google-li').fontpicker();
  $('.google-block').fontpicker();


  $('.google-body-div').hide();
  $('.custom-body-div').hide();

  $('.google-h1-div').hide();
  $('.custom-h1-div').hide();

  $('.google-h2-div').hide();
  $('.custom-h2-div').hide();

  $('.google-h3-div').hide();
  $('.custom-h3-div').hide();

  $('.google-h4-div').hide();
  $('.custom-h4-div').hide();

  $('.google-h5-div').hide();
  $('.custom-h5-div').hide();

  $('.google-h6-div').hide();
  $('.custom-h6-div').hide();


  $('.google-block-div').hide();
  $('.custom-block-div').hide();

  $('.google-p-div').hide();
  $('.custom-p-div').hide();

  $('.google-li-div').hide();
  $('.custom-li-div').hide();

  $('.google-a-div').hide();
  $('.custom-a-div').hide();


  $('.default-body-div').html('Activate <i class="fa fa-hand-o-right" aria-hidden="true"></i> ');
  $('.default-h1-div').html('Activate <i class="fa fa-hand-o-right" aria-hidden="true"></i> ');
  $('.default-h2-div').html('Activate <i class="fa fa-hand-o-right" aria-hidden="true"></i> ');
  $('.default-h3-div').html('Activate <i class="fa fa-hand-o-right" aria-hidden="true"></i> ');
  $('.default-h4-div').html('Activate <i class="fa fa-hand-o-right" aria-hidden="true"></i> ');
  $('.default-h5-div').html('Activate <i class="fa fa-hand-o-right" aria-hidden="true"></i> ');
  $('.default-h6-div').html('Activate <i class="fa fa-hand-o-right" aria-hidden="true"></i> ');
  $('.default-p-div').html('Activate <i class="fa fa-hand-o-right" aria-hidden="true"></i> ');
  $('.default-li-div').html('Activate <i class="fa fa-hand-o-right" aria-hidden="true"></i> ');
  $('.default-block-div').html('Activate <i class="fa fa-hand-o-right" aria-hidden="true"></i> ');
  $('.default-a-div').html('Activate <i class="fa fa-hand-o-right" aria-hidden="true"></i> ');



  /* ends here */


  $('select').on('change', function() {
      var el = this.value.split('-')[0];
      var type = this.value.split('-')[1];

      if(type == 'custom'){
        $('.'+type+'-'+el+'-div').show();
        $('.google'+'-'+el+'-div').hide();
        $('.default-'+el+'-div').html('');

        //reset google font here
        $('.google-'+el).val('').trigger('change');

      }

      if(type =='google'){
        $('.'+type+'-'+el+'-div').show();
        $('.custom'+'-'+el+'-div').hide();
        $('.default-'+el+'-div').html('');

        //reset custom font here
        $('.custom-'+el).val('none').change();

      }

      if(type == 'default'){
        $('.google-'+el+'-div').hide();
        $('.custom-'+el+'-div').hide();
        if(!$('#'+el+'-toggle').prop("checked")){
          $('.default-'+el+'-div').html(' Activate <i class="fa fa-hand-o-right" aria-hidden="true"></i> ');
        }else{
          $('.default-'+el+'-div').html(' <i class="fa fa-hand-o-left" aria-hidden="true"></i> Select Font Type ');
        }
      }


  });


  $(':checkbox').change(function(event) {
      var el = event.target.id;
      var type = String(el).split('-')[0];

      if($("#"+el).is(':checked')){

        $("#"+type+"-type-select").prop('disabled', false);

        if ( type == 'body'){
         //hide all other here
         $('#h1-row').hide();
          $('#h2-row').hide();
          $('#h3-row').hide();
          $('#h4-row').hide();
          $('#h5-row').hide();
          $('#h6-row').hide();
          $('#p-row').hide();
          $('#a-row').hide();
          $('#li-row').hide();
          $('#block-row').hide();

          // confirmation = confirm("This will reset all other fonts !");
          // if(confirmation){
          //   resetGoogleFonts();
          //   console.log("Reset everything ");
          //   //$('#body-toggle').prop("checked", true).change();

          // }else{
          //   alert("I saved my ass");
          //   $('#body-toggle').prop("checked", false).change();
          // }
        }

      }else{

        $("#"+type+"-type-select").prop('disabled', true);
        $('.default-'+type+'-div').html('Activate 👉');

        if(type == 'body'){
            //hide all other here
            $('#h1-row').show();
            $('#h2-row').show();
            $('#h3-row').show();
            $('#h4-row').show();
            $('#h5-row').show();
            $('#h6-row').show();
            $('#p-row').show();
            $('#a-row').show();
            $('#li-row').show();
            $('#block-row').show();
        }

      }

      $('#'+type+'-type-select').val(''+type+'-default').change();
      $('.google-'+type).val('').trigger('change');

      $('.google-'+type+'-div').css('display','none');
      $('.custom-'+type+'-div').css('display','none');

  });


  /** FONT PICKER INIT */




  /* ENDS HERE */
  
  $('#upgradeNow').click(function(){
    console.log("Added Cool Things!");
  });
  
  </script>

<!-- Modal -->
    <div class="modal fade "   id="demoModal"  tabindex="-1" role="dialog"
         aria-labelledby="demoModal" aria-hidden="true">
        <div class="modal-dialog modal-lg  modal-dialog-centered  " role="document">
            <div class="modal-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-6 bg-rhino rounded-left d-flex align-items-center text-center justify-content-center">
                          <div>
                     <img {% if active_flag == 'INACTIVE' %} src="static/images/modalimage.png" {% else %} src="static/images/error.png" {% endif %} class="mw-100" width="" alt="">
                              <div class="pt-3 ">
                                  
                              </div>
                          </div>
                        </div>
                        <div class="col-md-6 m-h-50 d-flex align-items-center justify-content-center">
                          <div class="px-sm-3">
                     <h4 class="text-center" style="color:green;">
                        {% if active_flag == 'INACTIVE' %}
                        Upgrade @ <del>$15</del> $9.99 Only
                        {% else %}
                        <p style="color:red;">You Will Lose All Your Custom Fonts !</p>
                        {% endif %}
                     </h4>
                     <br/>
                     {% if active_flag == 'INACTIVE' %}
                     <ul type="none">
                        <li> ✅ Unlimited Custom Fonts</li>
                        <li> ✅ Unlimited Google Fonts</li>
                        <li> ✅ Unlimited Customization's</li>
                        <li> ✅ 24/7 Live Support</li>
                     </ul>
                     {% else %}
                     <p>Don't leave us , Let us know, if we can help.</p>
                     <br/>
                     {% endif %}
                     <form  {% if active_flag == 'INACTIVE' %} action="/confirm_payment/{{app_token}}" {% else %} action="/cancel_charge/{{app_token}}" {% endif %} >
                     <div class="col-md-12 mb-3">
                        <input type="submit" class="btn btn-gradient btn-lg btn-block" {% if active_flag == 'INACTIVE' %}value="Upgrade" {% else %} value="Downgrade" {% endif %}>
                                  </div>
                              </form>
                              <div class="pt-3 text-center ">
                                  <small><a href="#" data-dismiss="modal" aria-label="Close" class="text-muted">No, I'll skip for Now.</a></small>
                              </div>
                          </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>
    <!-- Modal Ends -->

{% endblock %}
